<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DEGEN ROAST 3000 - Ultimate AI-Powered Crypto Roast Generator">
    <meta property="og:title" content="DEGEN ROAST 3000">
    <meta property="og:description" content="Get your crypto investments roasted by advanced AI. More brutal than your portfolio losses!">
    <meta property="og:image" content="https://tenor.com/view/stonks-up-stongs-meme-stocks-gif-15715298">
    <meta property="og:type" content="website">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CRITICAL iPad Mini Fix - Must be loaded first -->
    <style id="critical-ipad-mini-fix">
        /* The most aggressive possible CSS for iPad Mini */
        @media only screen and (width: 768px) and (height: 1024px),
               only screen and (device-width: 768px) and (device-height: 1024px) {
            html body .container.enhanced-ui .content-grid {
                display: grid !important;
                grid-template-columns: 100% !important;
                width: 100% !important;
                max-width: 100% !important;
                gap: 16px !important;
                padding: 16px !important;
                margin: 0 !important;
            }
            
            html body .container.enhanced-ui .content-grid .chat-section {
                width: 100% !important;
                min-height: 60vh !important; 
                height: 65vh !important;
                max-height: 70vh !important;
                order: 1 !important;
            }
            
            html body .container.enhanced-ui .content-grid .left-sidebar-wrapper {
                width: 100% !important;
                max-width: 100% !important;
                order: 2 !important;
            }
            
            html body .container.enhanced-ui .control-panel-component,
            html body .container.enhanced-ui #control-panel-container .control-panel-component {
                width: 100% !important;
                max-width: none !important;
                padding: 20px !important;
                border-radius: 12px !important;
                background-color: rgba(26, 32, 44, 0.95) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                margin-bottom: 20px !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            html body .container.enhanced-ui .theme-options,
            html body .control-panel-component .theme-options {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 12px !important;
                margin-bottom: 20px !important;
            }
            
            html body .container.enhanced-ui .level-controls,
            html body .control-panel-component .level-controls {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr) !important;
                gap: 10px !important;
                margin: 16px 0 !important;
                width: 100% !important;
            }
            
            html body .container.enhanced-ui .theme-button,
            html body .control-panel-component .theme-button {
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                height: 90px !important;
                padding: 12px !important;
                border-radius: 8px !important;
            }
            
            /* Force right sidebar hidden */
            html body .container.enhanced-ui .right-sidebar-wrapper {
                display: none !important;
            }
            
            /* Landscape override */
            @media (orientation: landscape) {
                .content-grid {
                    grid-template-columns: 350px 1fr !important;
                }
                
                .chat-section {
                    order: 2 !important;
                    height: calc(100vh - 120px) !important;
                    max-height: none !important;
                }
                
                .left-sidebar-wrapper {
                    order: 1 !important;
                    height: calc(100vh - 120px) !important;
                    overflow-y: auto !important;
                }
            }
        }
        
        /* Mobile-first layout for all devices */
        @media (max-width: 1024px) {
            /* Force chat to take priority */
            .content-grid {
                display: flex !important;
                flex-direction: column !important;
                width: 100% !important;
            }
            
            .chat-section {
                width: 100% !important;
                order: 1 !important;
                min-height: 75vh !important;
            }
            
            .left-sidebar-wrapper,
            .right-sidebar-wrapper {
                width: 100% !important;
                order: 2 !important;
            }
        }
    </style>
    
    <!-- Desktop Layout Fix (NEW) -->
    <style id="desktop-layout-fix">
        /* Fix for desktop layout issues */
        @media only screen and (min-width: 1025px) {
            /* Container structure */
            html body .container.enhanced-ui {
                display: flex !important;
                flex-direction: column !important;
                min-height: 100vh !important;
                background-color: var(--bg-primary) !important;
                background-image: 
                    radial-gradient(circle at 20% 35%, rgba(55, 114, 255, 0.1) 0%, transparent 30%),
                    radial-gradient(circle at 80% 10%, rgba(255, 51, 102, 0.05) 0%, transparent 20%) !important;
                padding: 1rem !important;
                overflow: hidden !important;
            }
            
            /* Header styling */
            html body #header-container {
                width: 100% !important;
                margin-bottom: 1rem !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Stonks ticker styling */
            html body #stonks-ticker {
                width: 100% !important;
                margin-bottom: 1rem !important;
                border-radius: 8px !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
                overflow: hidden !important;
                background: rgba(20, 30, 50, 0.8) !important;
                backdrop-filter: blur(5px) !important;
                display: flex !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Main grid layout */
            html body .container.enhanced-ui .content-grid {
                display: grid !important;
                grid-template-columns: 280px minmax(600px, 1fr) 280px !important;
                gap: 1.5rem !important;
                padding: 0 1rem !important;
                width: 100% !important;
                max-width: 1600px !important;
                margin: 0 auto !important;
                height: calc(100vh - 180px) !important;
                min-height: 500px !important;
            }
            
            /* Left sidebar styling */
            html body .container.enhanced-ui .content-grid .left-sidebar-wrapper {
                display: flex !important;
                flex-direction: column !important;
                gap: 1rem !important;
                height: 100% !important;
                max-height: calc(100vh - 220px) !important;
                overflow-y: auto !important;
                order: initial !important;
                width: auto !important;
                max-width: 280px !important;
            }
            
            /* Control panel styling */
            html body #control-panel-container {
                border-radius: 16px !important;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2) !important;
                overflow: hidden !important;
                transition: all 0.3s ease !important;
                flex: 0 0 auto !important;
                margin-bottom: 20px !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
                background: linear-gradient(135deg, rgba(25, 35, 55, 0.9), rgba(15, 20, 30, 0.95)) !important;
                backdrop-filter: blur(15px) !important;
                border: 1px solid rgba(255, 255, 255, 0.12) !important;
                z-index: 10 !important;
            }
            
            /* Soundboard styling */
            html body #soundboard-container {
                border-radius: 16px !important;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2) !important;
                overflow: hidden !important;
                transition: all 0.3s ease !important;
                flex: 1 1 auto !important;
                min-height: 350px !important;
                max-height: 600px !important;
                display: flex !important;
                flex-direction: column !important;
                opacity: 1 !important;
                visibility: visible !important;
                background: linear-gradient(135deg, rgba(25, 35, 55, 0.9), rgba(15, 20, 30, 0.95)) !important;
                backdrop-filter: blur(15px) !important;
                border: 1px solid rgba(255, 255, 255, 0.12) !important;
                z-index: 10 !important;
            }
            
            /* Fix for soundboard sound buttons */
            html body #soundboard-container .sound-buttons {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)) !important;
                gap: 8px !important;
                padding: 12px !important;
                overflow-y: auto !important;
                min-height: 200px !important;
                max-height: calc(100% - 105px) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important; 
                border-radius: 8px !important;
                background-color: rgba(0, 0, 0, 0.25) !important;
                margin: 0 6px 6px 6px !important;
            }
            
            /* Fix for sound buttons */
            html body #soundboard-container .sound-button {
                min-height: 80px !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                background-color: rgba(30, 40, 60, 0.8) !important;
                border: 1px solid rgba(255, 255, 255, 0.15) !important;
                border-radius: 8px !important;
                padding: 8px !important;
                transition: all 0.2s ease !important;
                cursor: pointer !important;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
            }
            
            html body #soundboard-container .sound-button-icon {
                font-size: 20px !important;
                margin-bottom: 6px !important;
                width: 36px !important;
                height: 36px !important;
                background-color: rgba(0, 0, 0, 0.2) !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 50% !important;
            }
            
            html body #soundboard-container .sound-button-label {
                font-size: 12px !important;
                font-weight: 500 !important;
                text-align: center !important;
                line-height: 1.2 !important;
                width: 100% !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* Sound categories fix */
            html body #soundboard-container .sound-categories {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 6px !important;
                margin: 0 6px 8px 6px !important;
                padding: 8px !important;
                background-color: rgba(0, 0, 0, 0.2) !important;
                border-radius: 8px !important;
                border: 1px solid rgba(255, 255, 255, 0.12) !important;
                max-height: 55px !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
            }
            
            html body #soundboard-container .category-button {
                background-color: rgba(55, 114, 255, 0.15) !important;
                color: #ffffff !important;
                padding: 6px 12px !important;
                min-height: 36px !important;
                min-width: 90px !important;
                border-radius: 6px !important;
                border: none !important;
                font-size: 0.9rem !important;
                font-weight: 600 !important;
            }
            
            /* Chat section styling */
            html body .container.enhanced-ui .content-grid .chat-section {
                display: flex !important;
                flex-direction: column !important;
                gap: 1rem !important;
                height: 100% !important;
                max-height: calc(100vh - 220px) !important;
                position: relative !important;
                order: initial !important;
                width: auto !important;
                min-height: unset !important;
            }
            
            /* Chat messages container */
            html body #chat-messages-container {
                flex: 1 !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2) !important;
                overflow: hidden !important;
                background: linear-gradient(135deg, rgba(20, 30, 50, 0.8), rgba(10, 15, 25, 0.9)) !important;
                backdrop-filter: blur(10px) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                transition: all 0.3s ease !important;
                min-height: 400px !important;
                display: flex !important;
                flex-direction: column !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Message input styling */
            html body #message-input-container {
                border-radius: 12px !important;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
                overflow: hidden !important;
                background: rgba(20, 30, 50, 0.8) !important;
                backdrop-filter: blur(10px) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                transition: all 0.3s ease !important;
                flex: 0 0 auto !important;
                min-height: 100px !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Right sidebar styling */
            html body .container.enhanced-ui .content-grid .right-sidebar-wrapper {
                display: flex !important;
                flex-direction: column !important;
                gap: 1rem !important;
                height: 100% !important;
                max-height: calc(100vh - 220px) !important;
                overflow-y: auto !important;
                order: initial !important;
                width: auto !important;
                max-width: 280px !important;
            }
            
            /* Meme gallery styling */
            html body #meme-gallery-container {
                border-radius: 12px !important;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
                overflow: hidden !important;
                transition: all 0.3s ease !important;
                flex: 1 !important;
                min-height: 400px !important;
                max-height: calc(100vh - 220px) !important;
                overflow-y: auto !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
                background: linear-gradient(135deg, rgba(20, 30, 50, 0.8), rgba(10, 15, 25, 0.9)) !important;
                backdrop-filter: blur(10px) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
            
            /* Disclaimer component */
            html body #disclaimer-container {
                width: 100% !important;
                margin-top: auto !important;
                box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1) !important;
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Fix for chat messages display */
            html body .chat-window-component {
                display: flex !important;
                flex-direction: column !important;
                width: 100% !important;
                height: 100% !important;
            }
            
            html body .messages-container {
                flex: 1 !important;
                overflow-y: auto !important;
                padding: 1.5rem !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 1rem !important;
                scroll-behavior: smooth !important;
                min-height: 350px !important;
            }
            
            /* Message styling */
            html body .message {
                max-width: 85% !important;
                padding: 1rem !important;
                border-radius: 0.5rem !important;
                animation: message-fade-in 0.3s ease-out !important;
                margin-bottom: 0.5rem !important;
            }
            
            html body .message.bot-message {
                align-self: flex-start !important;
                background: rgba(30, 36, 50, 0.8) !important;
                border-left: 4px solid var(--accent-primary) !important;
            }
            
            html body .message.user-message {
                align-self: flex-end !important;
                background: rgba(55, 114, 255, 0.15) !important;
                border-right: 4px solid var(--accent-primary) !important;
            }
            
            /* Message input component */
            html body .message-input-component {
                display: flex !important;
                flex-direction: column !important;
                width: 100% !important;
                padding: 1rem !important;
            }
            
            /* Control panel component */
            html body .control-panel-component {
                padding: 1.5rem !important;
                display: block !important;
            }
            
            html body .control-panel-header {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                margin-bottom: 1.5rem !important;
            }
            
            html body .theme-options {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            html body .theme-button {
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 8px !important;
                padding: 1rem !important;
                transition: all 0.3s ease !important;
                background: rgba(30, 36, 50, 0.5) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                cursor: pointer !important;
            }
            
            html body .theme-button.active {
                border: 1px solid var(--accent-primary) !important;
                box-shadow: 0 0 10px rgba(55, 114, 255, 0.3) !important;
            }
            
            html body .level-controls {
                display: flex !important;
                gap: 0.5rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            html body .level-button {
                flex: 1 !important;
                padding: 0.75rem !important;
                border-radius: 6px !important;
                background: rgba(30, 36, 50, 0.5) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                cursor: pointer !important;
                transition: all 0.3s ease !important;
                text-align: center !important;
            }
            
            html body .level-button.active {
                border: 1px solid var(--accent-primary) !important;
                background: rgba(55, 114, 255, 0.15) !important;
            }

            /* Hide fallback content */
            html body .container.enhanced-ui .fallback-content {
                display: none !important; 
            }
        }
    </style>
    
    <!-- EventBus Protection - Prevents EventBus from being used as a constructor -->
    <script>
        // This ensures even if someone uses 'new EventBus()', it won't crash the page
        window.EventBus = window.EventBus || {
            // Provide dummy methods that won't crash
            subscribe: function() { 
                console.warn("EventBus not fully loaded yet - subscription queued");
                return function() {}; // Return dummy unsubscribe function
            },
            publish: function(eventName, data) {
                console.warn("EventBus not fully loaded yet - publish delayed", eventName, data);
            },
            // Flag to indicate this is a temporary instance
            __isPlaceholder: true
        };
        
        // Add basic error tracking for debugging
        window.__eventBusErrors = [];
        
        // Track when scripts are loaded to help debug initialization issues
        window.__scriptLoadTimes = {};
        
        // Catch and log all JavaScript errors
        window.addEventListener('error', function(event) {
            // Create a timestamp
            const now = new Date();
            const timestamp = now.toLocaleTimeString();
            
            // Store all errors
            window.__allErrors = window.__allErrors || [];
            window.__allErrors.push({
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                timestamp: timestamp,
                error: event.error
            });
            
            // Specifically track EventBus errors
            if (event.message && event.message.includes('EventBus is not a constructor')) {
                window.__eventBusErrors.push({
                    message: event.message,
                    filename: event.filename,
                    lineno: event.lineno,
                    colno: event.colno,
                    timestamp: timestamp
                });
                
                console.error('ERROR: EventBus is not a constructor. Use window.EventBus directly.');
                event.preventDefault(); // Prevent the default error handling
            }
        }, true);
        
        // Track script loading
        function trackScriptLoading(scriptElement) {
            const src = scriptElement.src;
            if (!src) return; // Skip inline scripts
            
            const filename = src.split('/').pop();
            scriptElement.addEventListener('load', function() {
                window.__scriptLoadTimes[filename] = new Date().toLocaleTimeString();
                console.log(`Script loaded: ${filename}`);
            });
        }
        
        // Install the script tracking
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === 'script') {
                trackScriptLoading(element);
            }
            return element;
        };
        
        // Also expose a function to check script loading order
        window.checkScriptLoading = function() {
            console.table(window.__scriptLoadTimes);
        };
    </script>
    
    <!-- Favicon -->
    <link rel="icon" href="https://tenor.com/view/stonks-up-stongs-meme-stocks-gif-15715298">
    <link rel="apple-touch-icon" href="https://tenor.com/view/stonks-up-stongs-meme-stocks-gif-15715298">
    
    <!-- CSS Architecture - Properly Layered -->
    <!-- 1. CSS Reset - Normalize browser defaults -->
    <link rel="stylesheet" href="css/reset.css">
    
    <!-- 2. Variables and Base Styles - Define design tokens and elements base styles -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    
    <!-- 3. Core Layout - Desktop First Approach -->
    <link rel="stylesheet" href="css/app-layout.css">
    <link rel="stylesheet" href="css/enhanced-ui.css">
    <link rel="stylesheet" href="css/component-enhancements.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- 4. Components Styles -->
    <link rel="stylesheet" href="components/Header/Header.css">
    <link rel="stylesheet" href="components/StonksTicker/StonksTicker.css">
    <link rel="stylesheet" href="components/ControlPanel/ControlPanel.css">
    <link rel="stylesheet" href="components/ChatWindow/ChatWindow.css">
    <link rel="stylesheet" href="components/MessageInput/MessageInput.css">
    <link rel="stylesheet" href="components/Soundboard/Soundboard.css">
    <link rel="stylesheet" href="components/MemeGallery/MemeGallery.css">
    <link rel="stylesheet" href="components/Disclaimer/Disclaimer.css">
    
    <!-- 5. Theme-specific styles -->
    <link rel="stylesheet" href="css/theme.css">
    
    <!-- 6. Responsive and Mobile Overrides - These come LAST to override desktop styles -->
    <link rel="stylesheet" href="css/mobile-enhanced.css">
    
    <!-- Emergency fix for iPad Air layout in DevTools -->
    <style id="ipad-air-fix">
        @media only screen and (width: 820px) and (height: 1180px),
               only screen and (width: 834px) and (height: 1194px),
               only screen and (width: 768px) and (height: 1024px),
               only screen and (width: 1180px) and (height: 820px),
               only screen and (width: 1194px) and (height: 834px),
               only screen and (width: 1024px) and (height: 768px) {
            
            /* Force grid layout */
            .content-grid {
                display: grid !important;
                grid-template-columns: 100% !important;
                gap: 16px !important;
                padding: 16px !important;
            }
            
            /* Force chat section to top */
            .chat-section {
                width: 100% !important;
                order: 1 !important;
                min-height: 75vh !important;
            }
            
            .left-sidebar-wrapper,
            .right-sidebar-wrapper {
                width: 100% !important;
                order: 2 !important;
            }
        }
    </style>
    
    <!-- Image fallback script -->
    <script>
        function handleImageError(img) {
            // Try Tenor first
            if (!img.src.includes('tenor')) {
                img.src = 'https://tenor.com/view/stonks-up-stongs-meme-stocks-gif-15715298';
            }
            // If still failing, try Giphy as fallback
            else {
                img.src = 'https://media.giphy.com/media/YnkMcHgNIMW4Yfmjxr/giphy.gif';
                // Disable further onerror to prevent loops
                img.onerror = null;
            }
        }
    </script>
    
    <!-- Debug Helper Script - Load before everything else -->
    <script src="js/debug-helper.js"></script>
    
    <!-- Core Scripts - These must be loaded IMMEDIATELY (without defer) -->
    <script src="components/common/EventBus.js"></script>
    <script src="components/common/ComponentBase.js"></script>
    <script src="components/common/ThemeManager.js"></script>
    <script src="js/utils.js"></script>
    
    <!-- API Service - Load before main.js -->
    <script src="js/api-service.js"></script>
    
    <!-- API Debugger - Load after API Service -->
    <script src="js/api-debug.js"></script>
</head>
<body class="theme-crypto">
    <!-- iPad Mini Emergency Fix -->
    <script>
        console.log("üîç iPad Mini Debug - Window dimensions:", window.innerWidth, "x", window.innerHeight);
        
        // Immediately detect iPad Mini and add CSS classes
        if (window.innerWidth === 768 && window.innerHeight === 1024) {
            console.log("‚úÖ APPLYING CSS CLASSES FOR IPAD MINI!");
            
            // Mark document with data attribute and classes for CSS targeting
            document.documentElement.setAttribute('data-device', 'ipad-mini');
            document.documentElement.classList.add('ipad-mini-view', 'tablet-view');
            document.body.setAttribute('data-device', 'ipad-mini');
            document.body.classList.add('ipad-mini-view', 'tablet-view');
            
            // Also add orientation info for more specific CSS targeting
            const orientation = window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';
            document.documentElement.classList.add(`orientation-${orientation}`);
            document.body.classList.add(`orientation-${orientation}`);
        }
    </script>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading DEGEN ROAST 3000...</div>
    </div>

    <div class="container enhanced-ui">
        <!-- Debug Button -->
        <div style="position: fixed; top: 10px; right: 10px; z-index: 1000;">
            <button class="debug-button" id="debug-button">Debug Components</button>
        </div>
        
        <!-- Fallback content in case components don't load -->
        <div class="fallback-content" id="fallback-content">
            <h2>DEGEN ROAST 3000</h2>
            <p>There seems to be an issue loading the application components. Please check the browser console for more details.</p>
            <button class="debug-button" id="run-diagnostics">Run Diagnostics</button>
        </div>
        
        <!-- Header Component -->
        <div id="header-container"></div>
        
        <!-- Stonks Ticker Component -->
        <div id="stonks-ticker"></div>
        
        <div class="content-grid">
            <div class="left-sidebar-wrapper">
                <!-- Control Panel Component -->
                <div id="control-panel-container"></div>
                
                <!-- Soundboard Component -->
                <div id="soundboard-container"></div>
            </div>
            
            <div class="chat-section">
                <!-- Chat Window Component -->
                <div id="chat-messages-container"></div>
                
                <!-- Message Input Component -->
                <div id="message-input-container"></div>
            </div>
            
            <div class="right-sidebar-wrapper">
                <!-- Meme Gallery Component -->
                <div id="meme-gallery-container"></div>
            </div>
        </div>
        
        <!-- Disclaimer Component -->
        <div id="disclaimer-container"></div>
    </div>
    
    <!-- Component Scripts - load after the core components -->
    <script defer src="components/Header/Header.js"></script>
    <script defer src="components/StonksTicker/StonksTicker.js"></script>
    <script defer src="components/ControlPanel/ControlPanel.js"></script>
    <script defer src="components/ChatWindow/ChatWindow.js"></script>
    <script defer src="components/MessageInput/MessageInput.js"></script>
    <script defer src="components/Soundboard/Soundboard.js"></script>
    <script defer src="components/MemeGallery/MemeGallery.js"></script>
    <script defer src="components/Disclaimer/Disclaimer.js"></script>
    
    <!-- Mobile enhancements -->
    <script defer src="js/mobile-enhancements.js"></script>
    
    <!-- Component healing utility -->
    <script src="js/component-healing.js"></script>
    
    <!-- Initialize app -->
    <script src="js/main.js"></script>
    
    <!-- Show fallback content if components don't load after timeout -->
    <script>
        // Hide loading screen after everything is loaded
        window.addEventListener('load', function() {
            // First check if we're on desktop
            const isDesktop = window.innerWidth > 1024;
            
            // If on desktop, immediately apply desktop classes and hide fallback
            if (isDesktop) {
                console.log("Detected desktop - applying desktop layout");
                document.documentElement.classList.add('desktop-view');
                document.body.classList.add('desktop-view');
                document.documentElement.setAttribute('data-device', 'desktop');
                document.body.setAttribute('data-device', 'desktop');
                
                // Remove any tablet/mobile classes that might have been erroneously applied
                document.documentElement.classList.remove('mobile-view', 'tablet-view', 'ipad-view', 'ipad-mini-view');
                document.body.classList.remove('mobile-view', 'tablet-view', 'ipad-view', 'ipad-mini-view');
                
                // Hide fallback immediately
                const fallbackContent = document.getElementById('fallback-content');
                if (fallbackContent) fallbackContent.style.display = 'none';
            }
            
            setTimeout(function() {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('fade-out');
                    setTimeout(function() {
                        loadingOverlay.style.display = 'none';
                    }, 500);
                }
                
                // Force desktop layout if needed
                if (isDesktop) {
                    console.log("Applying desktop layout fixes...");
                    
                    // Try to apply desktop layout if function exists
                    if (typeof applyDesktopLayout === 'function') {
                        applyDesktopLayout();
                        
                        // Run it again after a short delay to ensure everything is properly styled
                        setTimeout(applyDesktopLayout, 500);
                    } else {
                        console.log('Manual layout fix applied');
                        
                        // Force display of all components
                        const componentContainers = [
                            'header-container', 
                            'stonks-ticker', 
                            'control-panel-container', 
                            'soundboard-container', 
                            'chat-messages-container', 
                            'message-input-container', 
                            'meme-gallery-container',
                            'disclaimer-container'
                        ];
                        
                        componentContainers.forEach(id => {
                            const container = document.getElementById(id);
                            if (container) {
                                container.style.display = 'block';
                                container.style.visibility = 'visible';
                                container.style.opacity = '1';
                            }
                        });
                        
                        // Manual desktop layout fix
                        const container = document.querySelector('.container.enhanced-ui');
                        const contentGrid = document.querySelector('.content-grid');
                        
                        if (container) {
                            container.style.display = 'flex';
                            container.style.flexDirection = 'column';
                            container.style.minHeight = '100vh';
                        }
                        
                        if (contentGrid) {
                            contentGrid.style.display = 'grid';
                            contentGrid.style.gridTemplateColumns = '280px minmax(600px, 1fr) 280px';
                            contentGrid.style.gap = '1.5rem';
                            contentGrid.style.width = '100%';
                            contentGrid.style.maxWidth = '1600px';
                            contentGrid.style.margin = '0 auto';
                            contentGrid.style.height = 'calc(100vh - 180px)';
                            contentGrid.style.minHeight = '500px';
                        }
                        
                        // Style chat section
                        const chatSection = document.querySelector('.chat-section');
                        if (chatSection) {
                            chatSection.style.display = 'flex';
                            chatSection.style.flexDirection = 'column';
                            chatSection.style.gap = '1rem';
                            chatSection.style.height = '100%';
                            chatSection.style.maxHeight = 'calc(100vh - 220px)';
                        }
                        
                        // Style sidebars
                        const leftSidebar = document.querySelector('.left-sidebar-wrapper');
                        if (leftSidebar) {
                            leftSidebar.style.display = 'flex';
                            leftSidebar.style.flexDirection = 'column';
                            leftSidebar.style.gap = '1rem';
                            leftSidebar.style.maxWidth = '280px';
                        }
                        
                        const rightSidebar = document.querySelector('.right-sidebar-wrapper');
                        if (rightSidebar) {
                            rightSidebar.style.display = 'flex';
                            rightSidebar.style.flexDirection = 'column';
                            rightSidebar.style.gap = '1rem';
                            rightSidebar.style.maxWidth = '280px';
                        }
                    }
                    
                    // Specifically force the desktop layout CSS to be applied
                    const desktopLayoutStyle = document.getElementById('desktop-layout-fix');
                    if (desktopLayoutStyle) {
                        // Force reflow to ensure styles are applied
                        desktopLayoutStyle.disabled = true;
                        desktopLayoutStyle.disabled = false;
                    }
                }
            }, 1000); // Wait 1 second after load to hide
        });
        
        // Set up debug button handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Debug button
            const debugButton = document.getElementById('debug-button');
            if (debugButton) {
                debugButton.addEventListener('click', function() {
                    if (window.debugHelper) {
                        window.debugHelper.checkComponents();
                    } else {
                        console.error('Debug helper not loaded');
                    }
                });
            }
            
            // Run diagnostics button
            const runDiagnosticsButton = document.getElementById('run-diagnostics');
            if (runDiagnosticsButton) {
                runDiagnosticsButton.addEventListener('click', function() {
                    if (window.debugHelper) {
                        window.debugHelper.checkComponents();
                    } else {
                        console.error('Debug helper not loaded');
                    }
                });
            }
        });
        
        // Show fallback content if initialization fails
        setTimeout(function() {
            if (document.getElementById('header-container').innerHTML === '') {
                document.getElementById('fallback-content').style.display = 'block';
                console.error('Components failed to initialize within timeout period.');
            }
        }, 15000); // Increased timeout to 15 seconds to allow for slower loading
    </script>
</body>
<script>
    // Immediate mobile viewport and layout fix script
    (function() {
        // Fix viewport meta tag immediately
        let viewport = document.querySelector('meta[name="viewport"]');
        if (!viewport) {
            viewport = document.createElement('meta');
            viewport.name = 'viewport';
            document.head.appendChild(viewport);
        }
        viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover';
        
        // Detect mobile immediately
        const isMobile = window.innerWidth <= 768;
        const isSmallMobile = window.innerWidth <= 480;
        
        // Add classes to html element for immediate CSS targeting
        if (isMobile) {
            document.documentElement.classList.add('mobile-view');
            if (isSmallMobile) {
                document.documentElement.classList.add('small-mobile-view');
            }
        }
        
        // Fix for DevTools being open
        if (window.innerHeight < window.outerHeight * 0.75) {
            document.documentElement.classList.add('devtools-open');
        }
        
        // Fix layout issues on mobile
        if (isMobile) {
            // Helper function to fix common layout issues
            function fixLayout() {
                // Force container to full width
                const containers = document.querySelectorAll('.container');
                containers.forEach(container => {
                    container.style.width = '100%';
                    container.style.maxWidth = '100%';
                    container.style.margin = '0';
                    container.style.boxSizing = 'border-box';
                });
                
                // Ensure chat section has proper height
                const chatSection = document.querySelector('.chat-section');
                if (chatSection) {
                    chatSection.style.minHeight = '70vh';
                    chatSection.style.display = 'flex';
                    chatSection.style.flexDirection = 'column';
                }
                
                // Fix chat window component
                const chatWindow = document.querySelector('.chat-window-component');
                if (chatWindow) {
                    chatWindow.style.flex = '1';
                    chatWindow.style.display = 'flex';
                    chatWindow.style.flexDirection = 'column';
                    chatWindow.style.height = '100%';
                }
                
                // Fix messages container
                const messagesContainer = document.querySelector('.messages-container');
                if (messagesContainer) {
                    messagesContainer.style.flex = '1';
                    messagesContainer.style.display = 'flex';
                    messagesContainer.style.flexDirection = 'column';
                    messagesContainer.style.height = '100%';
                    
                    // Scroll to bottom
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                
                // Hide debug elements
                const debugElements = document.querySelectorAll('.debug-button, #debug-button');
                debugElements.forEach(element => {
                    element.style.display = 'none';
                });
            }
            
            // Run immediately
            fixLayout();
            
            // And again after a short delay to ensure DOM is ready
            setTimeout(fixLayout, 100);
            
            // And again after all content is likely loaded
            setTimeout(fixLayout, 1000);
        }
    })();
</script>

<!-- Special iPad Mini Layout Diagnostic - this helps debug layout issues -->
<script>
    // Wait for everything to be fully loaded 
    window.addEventListener('load', function() {
        // Only run on iPad Mini dimensions
        if (window.innerWidth === 768 && window.innerHeight === 1024) {
            console.log("üîç iPad Mini Layout Diagnostic Running...");
            
            // Create diagnostic overlay
            function createDiagnosticOverlay() {
                const overlay = document.createElement('div');
                overlay.id = 'ipad-mini-diagnostic';
                overlay.style.cssText = `
                    position: fixed;
                    bottom: 10px;
                    right: 10px;
                    background: rgba(0,0,0,0.8);
                    color: lime;
                    padding: 10px;
                    border-radius: 5px;
                    font-family: monospace;
                    font-size: 12px;
                    z-index: 99999;
                    max-width: 250px;
                    max-height: 200px;
                    overflow: auto;
                `;
                
                document.body.appendChild(overlay);
                return overlay;
            }
            
            // Check layout and update overlay
            function checkLayout() {
                const overlay = document.getElementById('ipad-mini-diagnostic') || createDiagnosticOverlay();
                
                // Get important layout elements
                const contentGrid = document.querySelector('.content-grid');
                const chatSection = document.querySelector('.chat-section');
                const leftSidebar = document.querySelector('.left-sidebar-wrapper');
                const controlPanel = document.querySelector('.control-panel-component');
                
                // Get computed styles
                const gridStyle = contentGrid ? getComputedStyle(contentGrid) : null;
                const chatStyle = chatSection ? getComputedStyle(chatSection) : null;
                const sidebarStyle = leftSidebar ? getComputedStyle(leftSidebar) : null;
                const panelStyle = controlPanel ? getComputedStyle(controlPanel) : null;
                
                // Update diagnostic overlay
                overlay.innerHTML = `
                    <div><b>iPad Mini Layout:</b></div>
                    <div>Grid: ${gridStyle ? gridStyle.display + ' / ' + gridStyle.gridTemplateColumns + ' / ' + gridStyle.width : 'N/A'}</div>
                    <div>Chat: ${chatStyle ? chatStyle.width + ' / order: ' + chatStyle.order : 'N/A'}</div>
                    <div>Sidebar: ${sidebarStyle ? sidebarStyle.width + ' / order: ' + sidebarStyle.order : 'N/A'}</div>
                    <div>Panel: ${panelStyle ? panelStyle.display + ' / ' + panelStyle.width : 'N/A'}</div>
                    <button id="fix-layout-now" style="margin-top:5px;background:lime;color:black;border:0;padding:5px;border-radius:3px;width:100%;">Fix Layout Now</button>
                `;
                
                // Add fix button event
                document.getElementById('fix-layout-now').addEventListener('click', function() {
                    // Call our layout fix directly
                    if (typeof forceIPadMiniLayout === 'function') {
                        forceIPadMiniLayout();
                        setTimeout(checkLayout, 500); // Update after fixing
                    } else {
                        // Apply direct layout fixes
                        if (contentGrid) {
                            contentGrid.style.cssText = 'display:grid !important; grid-template-columns:100% !important; width:100% !important;';
                            
                            if (chatSection) chatSection.style.cssText = 'width:100% !important; order:1 !important;';
                            if (leftSidebar) leftSidebar.style.cssText = 'width:100% !important; order:2 !important;';
                        }
                        setTimeout(checkLayout, 500);
                    }
                });
            }
            
            // Run diagnostic immediately and periodically
            checkLayout();
            setInterval(checkLayout, 3000);
        }
    });
</script>
</html>